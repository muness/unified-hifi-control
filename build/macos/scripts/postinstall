#!/bin/bash

# Post-install script for Unified Hi-Fi Control

set -e

# Create directories
mkdir -p /usr/local/var/unified-hifi-control
mkdir -p /usr/local/var/log
mkdir -p /usr/local/share/unified-hifi-control

# Copy public assets (PKG should include these in payload)
# They get installed to /usr/local/share/unified-hifi-control/public/
if [ -d "/usr/local/share/unified-hifi-control/public" ]; then
    echo "Web assets installed to /usr/local/share/unified-hifi-control/public/"
else
    echo "Warning: Web assets not found. Service may not work correctly."
fi

# Set permissions
chmod 755 /usr/local/bin/unified-hifi-control

# Load the LaunchDaemon
launchctl load /Library/LaunchDaemons/com.cloudatlas.unified-hifi-control.plist 2>/dev/null || true

# Start the service
launchctl start com.cloudatlas.unified-hifi-control 2>/dev/null || true

echo "Unified Hi-Fi Control installed successfully!"
echo "Web UI available at: http://localhost:8088"

exit 0
